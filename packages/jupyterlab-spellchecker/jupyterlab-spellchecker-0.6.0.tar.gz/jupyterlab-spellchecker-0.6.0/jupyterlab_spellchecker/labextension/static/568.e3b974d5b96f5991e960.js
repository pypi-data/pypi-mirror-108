(self.webpackChunk_ijmbarr_jupyterlab_spellchecker=self.webpackChunk_ijmbarr_jupyterlab_spellchecker||[]).push([[568],{311:function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.requestAPI=void 0;const o=n(886),r=n(290);t.requestAPI=function(e="",t={}){return s(this,void 0,void 0,(function*(){const n=r.ServerConnection.makeSettings(),s=o.URLExt.join(n.baseUrl,"spellchecker",e);let i;try{i=yield r.ServerConnection.makeRequest(s,t,n)}catch(e){throw new r.ServerConnection.NetworkError(e)}const a=yield i.json();if(!i.ok)throw new r.ServerConnection.ResponseError(i,a.message);return a}))}},568:function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.spellcheckIcon=void 0;const o=n(632),r=n(611),i=n(950),a=n(138),c=n(510),l=n(904),d=n(527),u=n(981),h=n(311);n(549);const g=s(n(688));t.spellcheckIcon=new i.LabIcon({name:"spellcheck:spellcheck",svgstr:g.default});const p=n(397),m="Adjust spelling to",_="Spell Checker";class f{constructor(){this.ready=h.requestAPI("language_manager").then((e=>{console.debug("LanguageManager is ready"),this.languages=e.dictionaries}))}getChoices(e){return[e,...this.languages.filter((t=>t.id!==e.id)).sort(((e,t)=>e.name.localeCompare(t.name)))]}getLanguageByIdentifier(e){const t=this.languages.find((t=>t.id===e));if(t)return t;const n=this.languages.find((t=>t.id.toLowerCase()===e.replace("-","_").toLowerCase()));return n?(console.warn(`Language identifier ${e} has a non-exact match, please update it to ${n.id}`),n):void 0}}class k extends a.ReactWidget{constructor(e){super(),this.language_source=e}render(){return d.TextItem({source:this.language_source()})}}class v{constructor(e,t,n,s,o,r,i){this.app=e,this.tracker=t,this.editor_tracker=n,this.setting_registry=s,this.code_mirror=o,this.palette=r,this.status_bar=i,this.status_msg="Dictionary not loaded",this.check_spelling=!0,this.rx_word_char=/[^-[\]{}():/!;&@$£%§<>"*+=?.,~\\^|_`#±\s\t]/,this.rx_non_word_char=/[-[\]{}():/!;&@$£%§<>"*+=?.,~\\^|_`#±\s\t]/,this.ignored_tokens=new Set,this.define_mode=e=>{if(0===e.indexOf("spellcheck_"))return e;const t="spellcheck_"+e;return this.code_mirror.CodeMirror.defineMode(t,(n=>{const s={name:t,token:(e,t)=>{if(e.eatWhile(this.rx_word_char)){const t=e.current().replace(/(^')|('$)/g,"");if(""!==t&&!t.match(/^\d+$/)&&void 0!==this.dictionary&&!this.dictionary.check(t)&&!this.ignored_tokens.has(t))return"spell-error"}return e.eatWhile(this.rx_non_word_char),null}};return this.code_mirror.CodeMirror.overlayMode(this.code_mirror.CodeMirror.getMode(n,e),s,!0)})),t},this.language_manager=new f,this.setup_settings(),this.setup_button(),this.setup_suggestions(),this.setup_language_picker(),this.setup_ignore_action(),this.tracker.activeCellChanged.connect((()=>{this.tracker.activeCell&&this.setup_cell_editor(this.tracker.activeCell)})),this.editor_tracker.widgetAdded.connect(((e,t)=>this.setup_file_editor(t.content,!0))),this.editor_tracker.currentChanged.connect(((e,t)=>{null!==t&&this.setup_file_editor(t.content,!1)}))}setup_settings(){Promise.all([this.setting_registry.load(y.id),this.app.restored,this.language_manager.ready]).then((([e])=>{this.update_settings(e),e.changed.connect((()=>{this.update_settings(e)}))})).catch((e=>{console.error(e.message)}))}_set_theme(e){document.body.setAttribute("data-jp-spellchecker-theme",e)}update_settings(e){this.settings=e;const t=e.get("ignore").composite;this.ignored_tokens=new Set(t),this.accepted_types=e.get("mimeTypes").composite;const n=e.get("theme").composite;this._set_theme(n);const s=e.get("language").composite,o=this.language_manager.getLanguageByIdentifier(s);void 0===o?console.warn("The language "+s+" is not supported!"):(this.language=o,this.load_dictionary().catch(console.warn)),this.refresh_state()}setup_file_editor(e,t=!1){if(this.accepted_types&&-1!==this.accepted_types.indexOf(e.model.mimeType)){const t=this.extract_editor(e);this.setup_overlay(t)}t&&e.model.mimeTypeChanged.connect(((t,n)=>{setTimeout((()=>this.setup_file_editor(e)),0)}))}setup_cell_editor(e){if(null!==e&&"markdown"===e.model.type){const t=this.extract_editor(e);this.setup_overlay(t)}}extract_editor(e){return e.editor.editor}setup_overlay(e,t=!0){const n=e.getOption("mode");if("null"!==n)if(this.check_spelling)e.setOption("mode",this.define_mode(n));else{const t=n.match(/^spellcheck_/)?n.substr(11):n;e.setOption("mode",t)}else t&&setTimeout((()=>this.setup_overlay(e,!1)),0)}toggle_spellcheck(){this.check_spelling=!this.check_spelling,console.log("Spell checking is currently: ",this.check_spelling)}setup_button(){this.app.commands.addCommand("spellchecker:toggle-check-spelling",{label:"Toggle spellchecker",execute:()=>{this.toggle_spellcheck()}}),this.palette&&this.palette.addItem({command:"spellchecker:toggle-check-spelling",category:_})}get_contextmenu_context(){const e=this.app._contextMenuEvent,t=e.target.closest(".CodeMirror");if(null===t)return null;const n=t.CodeMirror,s=n.coordsChar({left:e.clientX,top:e.clientY});return{editor:n,position:s}}get_current_word(e){const{editor:t,position:n}=e,s=t.getDoc().getLine(n.line);let o=n.ch;for(;o>0&&s[o].match(this.rx_word_char);)o--;let r=n.ch;for(;r<s.length&&s[r].match(this.rx_word_char);)r++;return{line:n.line,start:o,end:r,text:s.substring(o,r)}}setup_suggestions(){this.suggestions_menu=new c.Menu({commands:this.app.commands}),this.suggestions_menu.title.label=m,this.suggestions_menu.title.icon=t.spellcheckIcon.bindprops({stylesheet:"menuItem"}),this.app.commands.addCommand("spellchecker:update-suggestions",{execute:e=>{},isVisible:e=>(this.prepare_suggestions(),!1)}),this.app.contextMenu.addItem({selector:".cm-spell-error",command:"spellchecker:update-suggestions"}),this.app.contextMenu.addItem({selector:".cm-spell-error",submenu:this.suggestions_menu,type:"submenu"}),this.app.commands.addCommand("spellchecker:apply-suggestion",{execute:e=>{this.apply_suggestion(e.name)},label:e=>e.name})}setup_ignore_action(){this.app.commands.addCommand("spellchecker:ignore",{execute:()=>{this.ignore()},label:"Ignore"}),this.app.contextMenu.addItem({selector:".cm-spell-error",command:"spellchecker:ignore"})}ignore(){const e=this.get_contextmenu_context();if(null===e)console.log("Could not ignore the word as the context was no longer available");else{const t=this.get_current_word(e);this.settings.set("ignore",[t.text.trim(),...this.settings.get("ignore").composite]).catch(console.warn)}}prepare_suggestions(){const e=this.get_contextmenu_context();let t;if(null===e)t=[];else{const n=this.get_current_word(e);t=this.dictionary.suggest(n.text)}if(this.suggestions_menu.clearItems(),t.length){for(const e of t)this.suggestions_menu.addItem({command:"spellchecker:apply-suggestion",args:{name:e}});this.suggestions_menu.title.label=m,this.suggestions_menu.title.className="",this.suggestions_menu.setHidden(!1)}else this.suggestions_menu.title.className="lm-mod-disabled",this.suggestions_menu.title.label="No spellcheck suggestions",this.suggestions_menu.setHidden(!0)}apply_suggestion(e){const t=this.get_contextmenu_context();if(null===t)return void console.warn("Applying suggestion failed (probably was already applied earlier)");const n=this.get_current_word(t);t.editor.getDoc().replaceRange(e,{ch:n.start,line:n.line},{ch:n.end,line:n.line})}load_dictionary(){return this.status_msg="Loading dictionary ...",this.status_widget.update(),Promise.all([fetch(this.language.aff).then((e=>e.text())),fetch(this.language.dic).then((e=>e.text()))]).then((e=>{this.dictionary=new p(this.language.name,e[0],e[1]),console.debug("Dictionary Loaded ",this.language.name,this.language.id),this.status_msg=this.language.name,this.status_widget.update(),this.refresh_state()}))}refresh_state(){null!==this.tracker.activeCell&&this.setup_cell_editor(this.tracker.activeCell),null!==this.editor_tracker.currentWidget&&this.setup_file_editor(this.editor_tracker.currentWidget.content)}choose_language(){const e=this.language_manager.getChoices(this.language),t=e.map((e=>e.name+" ["+e.id+"]"));a.InputDialog.getItem({title:"Choose spellchecker language",items:t}).then((n=>{if(null!==n.value){const s=t.indexOf(n.value),o=this.language_manager.getLanguageByIdentifier(e[s].id);if(!o)return void console.error("Language could not be matched - please report this as an issue");this.language=o,this.settings.set("language",this.language.id).catch(console.warn)}}))}setup_language_picker(){this.status_widget=new k((()=>this.status_msg)),this.status_widget.node.onclick=()=>{this.choose_language()},this.app.commands.addCommand("spellchecker:choose-language",{execute:e=>this.choose_language(),label:"Choose spellchecker language"}),this.palette&&this.palette.addItem({command:"spellchecker:choose-language",category:_}),this.status_bar&&this.status_bar.registerStatusItem("spellchecker:choose-language",{align:"right",item:this.status_widget})}}const y={id:"@ijmbarr/jupyterlab_spellchecker:plugin",autoStart:!0,requires:[r.INotebookTracker,o.IEditorTracker,l.ISettingRegistry,u.ICodeMirror],optional:[a.ICommandPalette,d.IStatusBar],activate:function(e,t,n,s,o,r,i){console.log("Attempting to load spellchecker");const a=new v(e,t,n,s,o,r,i);console.log("Spellchecker Loaded ",a)}};t.default=y},760:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var s=n(645),o=n.n(s)()((function(e){return e[1]}));o.push([e.id,"body[data-jp-spellchecker-theme='background-box'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  background: rgba(255, 0, 0, .15);\n}\n\nbody[data-jp-spellchecker-theme='background-box'][data-jp-theme-light='false'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  background: rgba(255, 0, 0, .35);\n  text-shadow: 0 0 5px black;\n}\n\nbody[data-jp-spellchecker-theme='wavy-underline'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  text-decoration-line: underline;\n  text-decoration-style: wavy;\n  text-decoration-color: red;\n  /* For Chrome */\n  text-decoration-skip-ink: none;\n}\n\nbody[data-jp-spellchecker-theme='wavy-underline'][data-jp-theme-light='false'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  /* Use bright red for dark themes */\n  text-decoration-color: #ff5722;\n}\n\nbody[data-jp-spellchecker-theme='dotted-underline'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  text-decoration-line: underline;\n  text-decoration-style: dotted;\n  text-decoration-color: red;\n  /* For Chrome */\n  text-decoration-skip-ink: none;\n}\n\nbody[data-jp-spellchecker-theme='dotted-underline'][data-jp-theme-light='false'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  /* Use bright red for dark themes */\n    text-decoration-color: #ff5722;\n}\n",""]);const r=o},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,s){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(s)for(var r=0;r<this.length;r++){var i=this[r][0];null!=i&&(o[i]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);s&&o[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},688:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});const s='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M12.45 16h2.09L9.43 3H7.57L2.46 16h2.09l1.12-3h5.64l1.14 3zm-6.02-5L8.5 5.48L10.57 11H6.43zm15.16.59l-8.09 8.09L9.83 16l-1.41 1.41l5.09 5.09L23 13l-1.41-1.41z"/>\n  </g>\n</svg>\n'},549:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var s=n(379),o=n.n(s),r=n(760);o()(r.Z,{insert:"head",singleton:!1});const i=r.Z.locals||{}},379:(e,t,n)=>{"use strict";var s,o=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),r=[];function i(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].identifier===e){t=n;break}return t}function a(e,t){for(var n={},s=[],o=0;o<e.length;o++){var a=e[o],c=t.base?a[0]+t.base:a[0],l=n[c]||0,d="".concat(c," ").concat(l);n[c]=l+1;var u=i(d),h={css:a[1],media:a[2],sourceMap:a[3]};-1!==u?(r[u].references++,r[u].updater(h)):r.push({identifier:d,updater:m(h,t),references:1}),s.push(d)}return s}function c(e){var t=document.createElement("style"),s=e.attributes||{};if(void 0===s.nonce){var r=n.nc;r&&(s.nonce=r)}if(Object.keys(s).forEach((function(e){t.setAttribute(e,s[e])})),"function"==typeof e.insert)e.insert(t);else{var i=o(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}return t}var l,d=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function u(e,t,n,s){var o=n?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(e.styleSheet)e.styleSheet.cssText=d(t,o);else{var r=document.createTextNode(o),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(r,i[t]):e.appendChild(r)}}function h(e,t,n){var s=n.css,o=n.media,r=n.sourceMap;if(o?e.setAttribute("media",o):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}var g=null,p=0;function m(e,t){var n,s,o;if(t.singleton){var r=p++;n=g||(g=c(t)),s=u.bind(null,n,r,!1),o=u.bind(null,n,r,!0)}else n=c(t),s=h.bind(null,n,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s));var n=a(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var s=0;s<n.length;s++){var o=i(n[s]);r[o].references--}for(var c=a(e,t),l=0;l<n.length;l++){var d=i(n[l]);0===r[d].references&&(r[d].updater(),r.splice(d,1))}n=c}}}}}]);