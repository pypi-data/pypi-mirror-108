{% load cms_tags sekizai_tags %}


{% addtoblock "css" %}
    <style type="text/css">
        .djangocms_popup{
            border: 1px solid red;
            visibility: hidden;
            position: fixed;
            bottom: 3px;
            right: 3px;
            width: 30%;
            max-width: 500px;
            padding: 5px;
            background-color: white;
        }
        .djangocms_popup span{
            font-size: 1.2em;
        }
        .djangocms_popup_close{
            cursor: pointer;
            position: absolute;
            top: 2px;
            right: 2px;
            visibility: hidden;
        }

    </style>
{% endaddtoblock %}


{% addtoblock "js" %}
    <script type="text/javascript">
        let popup = document.getElementById("popup_{{instance.id}}");
        let popup_close_button = document.getElementById("popup_close_{{instance.id}}")

        popup_localstorage = window.localStorage;

        // if not defined = set to true
        if (popup_localstorage.getItem('popup_is_open_{{instance.id}}') == null){
            popup_localstorage.setItem('popup_is_open_{{instance.id}}', "true");
        }

        // show open/close button if we have popup_is_open to false and can_reopen_popup to true
        {% if instance.can_reopen_popup %}
            if (popup_localstorage.getItem('popup_is_open_{{instance.id}}') == "false"){
                popup_close_button.style.visibility = "visible";
            }
        {% endif %}


        // show/hide event listener
        popup_close_button.addEventListener("click", click_show_hide_popup);
        if (popup_localstorage.getItem('popup_is_open_{{instance.id}}') == "true"){
            setTimeout(function(){
                display_popup();
            }, {{instance.display_delay}}*1000);
        }

        // show/hide function
        function click_show_hide_popup(){
            if (popup_localstorage.getItem('popup_is_open_{{instance.id}}') == "true"){
                popup_localstorage.setItem('popup_is_open_{{instance.id}}', "false");
                hide_popup();
            }
            else{
                popup_localstorage.setItem('popup_is_open_{{instance.id}}', "true");
                display_popup();
            }
        }

        function display_popup(){
            popup.style.visibility = "visible";
            popup_close_button.style.visibility = "visible";
        }

        function hide_popup(){
            popup.style.visibility = "hidden";
            {% if not instance.can_reopen_popup %}
                popup_close_button.style.visibility = "hidden";
            {% endif %}
        }
    </script>
{% endaddtoblock %}


<div class="djangocms_popup" id="popup_{{instance.id}}">
    <div class="djangocms_popup_close" id="popup_close_{{instance.id}}">
        &#128473;
    </div>

    {% for plugin in instance.child_plugin_instances %}
        {% render_plugin plugin %}
    {% endfor %}
</div>
