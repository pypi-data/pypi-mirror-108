(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{401:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return ie}});var n=r(5893),a=r(2875),i=r(7183),o=r(1606),s=r(6129),l=r(1382),u=r(3888),c=r(7294),d=r(727),f=r(1163),h=r(7757),p=r.n(h),m=r(2137),x=r(6610),y=r(5991),g=r(6156),v=r(8949),b=r(6486);function j(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var w=new(function(){function e(){(0,x.Z)(this,e),(0,g.Z)(this,"loaded",!1),(0,g.Z)(this,"failed",!1),(0,g.Z)(this,"currentUrl",null),(0,g.Z)(this,"data",{}),(0,v.rC)(this,{loaded:v.LO,failed:v.LO,currentUrl:v.LO,data:v.LO.ref,possibleValues:v.Fl,fetchUrl:v.aD,setLoaded:v.aD})}return(0,y.Z)(e,[{key:"fetchUrl",value:function(){var e=(0,m.Z)(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.currentUrl){e.next=2;break}return e.abrupt("return");case 2:return this.loaded=!1,this.currentUrl=t,e.prev=4,e.next=7,new Promise((function(e){return setTimeout(e,2e3)}));case 7:return e.next=9,fetch(t);case 9:return r=e.sent,this.failed=!1,e.t0=this,e.next=14,r.json();case 14:e.t1=e.sent,e.t0.setLoaded.call(e.t0,e.t1),e.next=22;break;case 18:e.prev=18,e.t2=e.catch(4),console.log(e.t2),this.failed=!0;case 22:case"end":return e.stop()}}),e,this,[[4,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setLoaded",value:function(e){this.data=e,this.loaded=!0}},{key:"possibleValues",get:function(){var e,t=this,r=this.data.data[0].length,n=[],a=j((0,b.range)(r));try{var i=function(){var r=e.value,a=(0,b.uniq)(t.data.data.map((function(e){return e[r]})));n.push(a)};for(a.s();!(e=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return n}}]),e}()),Z=r(8481),k=r(5638),A=r(5924),M=r(4062),C=r(7933),O=r(7901),_=r(8641),I=r(7448),P=r(5739),F=r(1512);function D(e,t){var r=e.map((function(e){return Math.abs(t-e)})),n=(0,b.min)(r);return r.indexOf(n)}function H(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return V(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return V(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var z=function(){function e(){(0,x.Z)(this,e),(0,g.Z)(this,"last_params",new Set),(0,g.Z)(this,"modes",{}),(0,g.Z)(this,"sliderValues",{}),(0,g.Z)(this,"selectedHeatMapCell",null),(0,v.rC)(this,{update:v.aD,resetState:v.aD,modes:v.LO,sliderValues:v.LO,selectedHeatMapCell:v.LO,selectedSamples:v.Fl,selectedSamplesWHeatmap:v.Fl,heatMapAxes:v.Fl,heatMapAxesIx:v.Fl,heatMapData:v.Fl,heatMapBins:v.Fl})}return(0,y.Z)(e,[{key:"resetState",value:function(){var e=w.data.parameters;this.modes=Object.fromEntries(e.map((function(e){return[e,"aggregate"]}))),this.sliderValues=Object.fromEntries(e.map((function(e){var t=w.data.parameters.indexOf(e);return[e,w.possibleValues[t][0]]})))}},{key:"update",value:function(){var e=w.data.parameters,t=new Set(Object.values(e).map((function(e){return e.split(".")[0]})));0!==(0,b.xor)(Array.from(t),Array.from(this.last_params)).length&&(this.last_params=t,this.resetState())}},{key:"heatMapAxes",get:function(){return Object.entries(this.modes).filter((function(e){var t=(0,Z.Z)(e,2);t[0];return"heatmap"===t[1]})).map((function(e){return e[0]}))}},{key:"heatMapAxesIx",get:function(){return this.heatMapAxes.map((function(e){return w.data.parameters.indexOf(e)}))}},{key:"heatMapData",get:function(){var e=this.heatMapAxesIx,t=this.selectedSamples,r=w.data.parameters;return t.map((function(t){return[t[e[0]],t[e[1]],t[r.indexOf("is_correct")]]}))}},{key:"selectedSamples",get:function(){var e=this;return w.data.data.filter((function(t){return(0,b.every)(w.data.parameters,(function(r,n){return 1==w.possibleValues[n].length||("aggregate"==e.modes[r]||("heatmap"==e.modes[r]||"slider"==e.modes[r]&&t[n]==e.sliderValues[r]))}))}))}},{key:"selectedSamplesWHeatmap",get:function(){var e=this,t=this.selectedSamples;if(null==this.selectedHeatMapCell)return t;var r=this.sampleHeatMapCoords;return t.filter((function(t,n){return r[n][0]===e.selectedHeatMapCell[0]&&r[n][1]===e.selectedHeatMapCell[1]}))}},{key:"heatMapBins",get:function(){var e=this.heatMapData,t=function(t){var r=e.map((function(e){return e[t]})),n=(0,b.uniq)(r);n.sort();if(n.length>10){var a=[(0,b.min)(n),(0,b.max)(n)],i=a[0],o=a[1],s=(o-i)/9;return(0,b.range)(i,o+s,s)}return n};return[t(0),t(1)]}},{key:"sampleHeatMapCoords",get:function(){var e=(0,Z.Z)(this.heatMapBins,2),t=e[0],r=e[1];return this.heatMapData.map((function(e){var n=(0,Z.Z)(e,3),a=n[0],i=n[1];n[2];return[D(t,a),D(r,i)]}))}},{key:"filteredAccuracy",get:function(){var e,t=this.selectedSamplesWHeatmap,r=w.data.parameters.indexOf("is_correct"),n=0,a=H(t);try{for(a.s();!(e=a.n()).done;){e.value[r]&&n++}}catch(i){a.e(i)}finally{a.f()}return n/t.length}}]),e}(),E=r(7229),U=r(800),B=r.n(U)()({colormap:[{index:0,rgb:[168,50,50]},{index:1,rgb:[50,168,82]}],nshades:101,format:"hex",alpha:1});function L(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var W=(0,d.Pi)((function(e){var t=e.currentState.selectedSamplesWHeatmap;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(E.ZP,{grid:{gutter:15,column:6},dataSource:t,pagination:{pageSize:36,position:"top"},renderItem:function(e){var t=function(e){return(0,b.fromPairs)((0,b.zip)(w.data.parameters,e))}(e),r=t.is_correct,a={position:"relative",boxSizing:"content-box",borderWidth:"10px",borderStyle:"solid",borderColor:"black"};a.borderColor=r?"#32a852":"#a83232";var i={fill:"rgba(0,0,0,0)",strokeWidth:"3",stroke:"rgb(0,0,0)"},o=[],s=[];if("bboxes"==t.output_type){var l,u=L(t.boxes);try{for(u.s();!(l=u.n()).done;){var c=l.value;if(c[0]<0)break;var d=Math.random().toString().substr(2,8);o.push((0,n.jsx)("rect",{x:100*c[0]+"%",y:100*c[1]+"%",width:100*(c[2]-c[0])+"%",height:100*(c[3]-c[1])+"%",style:i},d+"_rect")),s.push((0,n.jsx)("text",{x:100*c[0]+"%",y:100*c[1]+"%",fontSize:"8",style:{stroke:"white",strokeWidth:"0.6em"},transform:"translate(0 10)",children:w.data.class_map[c[5]]},d+"_text")),s.push((0,n.jsx)("text",{x:100*c[0]+"%",y:100*c[1]+"%",fontSize:"8",transform:"translate(0 10)",children:w.data.class_map[c[5]]},d+"_textbg"))}}catch(p){u.e(p)}finally{u.f()}}else if("classes"==t.output_type){var f=w.data.class_map[t.prediction[0]],h=Math.random().toString().substr(2,8);s.push((0,n.jsx)("text",{x:"0",y:"0",fontSize:"10",style:{stroke:"white",strokeWidth:"0.6em"},transform:"translate(0 10)",children:f},h+"_text")),s.push((0,n.jsx)("text",{x:"0",y:"0",fontSize:"10",transform:"translate(0 10)",children:f},h+"_textbg"))}return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(E.ZP.Item,{style:{marginTop:"15px",marginBottom:"0"},children:(0,n.jsxs)("div",{style:a,children:[(0,n.jsx)("img",{style:{width:"100%"},src:new URL("images/".concat(t.id),w.currentUrl).toString()}),(0,n.jsxs)("svg",{width:"100%",height:"100%",style:{position:"absolute",zIndex:"100",left:0,top:0},children:[o,s,"Sorry, your browser does not support inline SVG."]})]})})})}})})}));function N(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var $=k.Z.Column,G=(k.Z.ColumnGroup,A.Z.Panel,M.Z.Option),R=(0,d.Pi)((function(e){var t=e.record,r=e.currentState,a=r.modes[t.key],i="undefined"!=typeof t.children;if(i){var o=t.children.map((function(e){var t=e.key;return r.modes[t]}));1==new Set(o).size&&(a=o[0])}var s=!i&&Object.values(r.modes).filter((function(e){return"heatmap"===e})).length<2||"heatmap"===a;return(0,n.jsxs)(C.ZP.Group,{optionType:"button",buttonStyle:"solid",size:"medium",onChange:(0,v.aD)((function(e){var n=e.target.value;if(i)for(var a=0,o=Object.keys(r.modes);a<o.length;a++){var s=o[a];s.startsWith(t.key)&&(r.modes[s]=n)}else r.modes[t.key]=n})),value:a,children:[(0,n.jsx)(C.ZP.Button,{value:"heatmap",size:"large",disabled:!s,children:(0,n.jsx)(O.Z,{title:"Heat map parameter",children:(0,n.jsx)(I.Z,{})})}),(0,n.jsx)(C.ZP.Button,{value:"slider",children:(0,n.jsx)(O.Z,{title:"Select value with slider",children:(0,n.jsx)(P.Z,{})})}),(0,n.jsx)(C.ZP.Button,{value:"aggregate",children:(0,n.jsx)(O.Z,{title:"Aggregate all samples",children:(0,n.jsx)(F.Z,{})})})]})})),X=(0,d.Pi)((function(e){var t=e.record,r=e.currentState;if("undefined"!=typeof t.children)return null;var a=t.key;if("slider"!==r.modes[a])return null;var i=w.data.parameters.indexOf(a),o=w.possibleValues[i],s=(0,b.max)(o),l=(0,b.min)(o);if(isNaN(s))return(0,n.jsx)(M.Z,{value:r.sliderValues[a],onChange:(0,v.aD)((function(e){r.sliderValues[a]=e})),children:o.map((function(e){return(0,n.jsx)(G,{value:e,children:e},e)}))});var u=Object.fromEntries(o.map((function(e){return[e,""]})));return(0,n.jsx)(_.Z,{value:r.sliderValues[a],marks:u,step:null,min:l,max:s,onChange:(0,v.aD)((function(e){r.sliderValues[a]=e}))})})),Y=function(e){var t,r=e.currentState,a=(w.data,w.data.parameters.filter((function(e){return e.startsWith("render_args")||"model"===e||"environment"===e}))),i={},o=N(Object.values(a).filter((function(e){var t=w.data.parameters.indexOf(e);return w.possibleValues[t].length>1})));try{for(o.s();!(t=o.n()).done;){var s=t.value,l=s.replace("render_args.","").split("."),u=(0,Z.Z)(l,2),c=u[0],d=u[1];"model"!==c&&"environment"!==c||(d=c,c="Scene"),"undefined"===typeof i[c]&&(i[c]={key:c,control:c.replace("Control",""),param:"",children:[]}),i[c].children.push({key:s,control:"",param:d})}}catch(h){o.e(h)}finally{o.f()}var f=Object.values(i);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(k.Z,{dataSource:f,bordered:!0,size:"small",pagination:!1,children:[(0,n.jsx)($,{title:"Control",dataIndex:"control",width:"175px"},"control"),(0,n.jsx)($,{title:"Parameter",dataIndex:"param",width:"100px"},"param"),(0,n.jsx)($,{title:"Mode",dataIndex:"age",width:"160px",render:function(e,t){return(0,n.jsx)(R,{record:t,currentState:r})}},"age"),(0,n.jsx)($,{title:"Filter",render:function(e,t){return(0,n.jsx)(X,{record:t,currentState:r})}},"address")]})})},K=(0,d.Pi)((function(e){var t=e.currentState,r=t.heatMapAxes;if(2!=r.length)return(0,n.jsx)(s.ZP,{status:"error",title:"Error",subTitle:"You need to have exactly two parameters in heatmap mode to enable this display"});var a,i=t.heatMapData,o=(0,Z.Z)(t.heatMapBins,2),l=o[0],u=o[1],c=l.map((function(e){return u.map((function(e){return 0}))})),d=l.map((function(e){return u.map((function(e){return 0}))})),f=N(i);try{for(f.s();!(a=f.n()).done;){var h=(0,Z.Z)(a.value,3),p=h[0],m=h[1],x=h[2],y=D(l,p),g=D(u,m);c[y][g]++,x&&d[y][g]++}}catch(b){f.e(b)}finally{f.f()}return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{style:{width:"100%",height:"100%",backgroundColor:"white",padding:"15px 15px 20px 30px"},children:[(0,n.jsx)("p",{children:"Click any cell to see the corresponding images"}),(0,n.jsx)("table",{style:{width:"100%",height:"100%",borderSpacing:"3px",borderCollapse:"separate",textAlign:"center",color:"white",fontWeight:"bold"},children:u.map((function(e,a){return(0,n.jsx)("tr",{children:l.map((function(i,o){var s=d[o][a]/c[o][a];return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(O.Z,{arrowPointAtCenter:!0,title:function(){return(0,n.jsxs)(n.Fragment,{children:[d[o][a],"/",c[o][a]," (",(100*s).toFixed(1),"%) correct ",(0,n.jsx)("br",{}),r[0].split(".")[1],"=",i.toPrecision(6)," ",(0,n.jsx)("br",{}),r[1].split(".")[1],"=",e.toPrecision(6)," ",(0,n.jsx)("br",{})]})},children:(0,n.jsxs)("td",{style:{backgroundColor:B[Math.round(s*(B.length-1))]},width:"".concat(100/l.length,"%"),onMouseUp:(0,v.aD)((function(){null==t.selectedHeatMapCell?t.selectedHeatMapCell=[o,a]:t.selectedHeatMapCell=null})),children:[Math.round(100*s),"%"]},"col".concat(o))})})}))},"row".concat(a))}))}),(0,n.jsx)("div",{style:{position:"absolute",bottom:0,width:"100%",textAlign:"center",height:"20px"},children:r[0].replace("render_args.","")}),(0,n.jsx)("div",{style:{position:"absolute",top:0,height:"100%",textAlign:"center",width:"20px"},children:(0,n.jsx)("div",{style:{position:"absolute",bottom:"50%",transform:"rotate(-90deg) translateY(-125px)",transformOrigin:"50% 0",width:"200px"},children:r[1].replace("render_args.","")})})]})})})),J=function(){var e=(0,c.useState)(null),t=e[0],r=e[1];return null===t?r(new z):t.update(),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{position:"relative",backgroundColor:"white"},children:[(0,n.jsx)("div",{style:{width:"50%",display:"inline-block",padding:"20px"},children:(0,n.jsx)(Y,{currentState:t})}),(0,n.jsx)("div",{style:{width:"50%",display:"block",position:"absolute",paddingLeft:"10px",height:"100%",top:0,right:0},children:(0,n.jsx)(K,{currentState:t})})]}),(0,n.jsx)(W,{currentState:t})]})},Q=(a.Z.SubMenu,i.Z.Header),ee=i.Z.Content,te=i.Z.Footer,re=(i.Z.Sider,o.Z.Search),ne=(0,n.jsx)(u.Z,{style:{fontSize:16,color:"#1890ff"}}),ae=function(e){var t=e.setServer,r=e.loading,a=e.startValue,i=(0,c.useState)(""),o=i[0],s=i[1];return(0,c.useEffect)((function(e){s(a)}),[a]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(re,{style:{marginTop:"12px"},enterButton:"Connect",value:o,size:"large",loading:r,suffix:ne,prefix:"http://",onChange:function(e){return s(e.target.value)},onSearch:function(e){return t(e)}})})},ie=(0,d.Pi)((function(){var e=(0,f.useRouter)(),t=(0,c.useState)(""),r=t[0],o=t[1];(0,c.useEffect)((function(){""===r&&("undefined"!==typeof e.query.url?o(e.query.url):o("".concat(window.location.hostname,":").concat(window.location.port)))})),console.log(r),""!=r&&w.fetchUrl("http://"+r+"/log.json");var u=!w.loaded&&""!=r&&!w.failed,d=(0,n.jsx)("div",{children:"Fill the url of your 3DB dashboard API"}),h=null;return w.failed?d=(0,n.jsx)(s.ZP,{status:"500",title:"Error loading the data",subTitle:"Are you sure the Url is correct and the API server is running ?"}):w.loaded?(h=(0,n.jsxs)(a.Z,{style:{display:"inline-block"},theme:"dark",mode:"horizontal",defaultSelectedKeys:["details"],children:[(0,n.jsx)(a.Z.Item,{children:"Summary"},"home"),(0,n.jsx)(a.Z.Item,{children:"Detail view"},"details"),(0,n.jsx)(a.Z.Item,{children:"Analytics"},"stratified")]}),d=(0,n.jsx)(J,{})):u&&(d=(0,n.jsx)(l.Z,{size:"large",style:{margin:"auto"}})),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(i.Z,{style:{height:"100%"},children:[(0,n.jsxs)(Q,{className:"header",children:[(0,n.jsx)("div",{style:{display:"inline-block",marginRight:"15px",color:"white",fontWeight:"bold"},children:"3DB"}),h,(0,n.jsx)("div",{style:{position:"absolute",right:"12px",top:0,color:"white"},children:(0,n.jsx)(ae,{setServer:o,loading:u,startValue:r})})]}),(0,n.jsx)(ee,{style:{padding:"0 50px",height:"100%"},children:(0,n.jsx)(i.Z,{className:"site-layout-background",style:{padding:"24px 0",height:"100%"},children:(0,n.jsx)(ee,{style:{padding:"0 24px",minHeight:280,height:"100%"},children:d})})}),(0,n.jsx)(te,{style:{textAlign:"center"},children:"3DB \xa92021 "})]})})}))},8581:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(401)}])}},function(e){e.O(0,[461,662,249,774,888,179],(function(){return t=8581,e(e.s=t);var t}));var t=e.O();_N_E=t}]);