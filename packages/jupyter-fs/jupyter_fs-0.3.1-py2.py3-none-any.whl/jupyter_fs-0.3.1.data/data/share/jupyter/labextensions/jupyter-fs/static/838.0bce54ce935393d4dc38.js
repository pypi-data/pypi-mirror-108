(self.webpackChunkjupyter_fs=self.webpackChunkjupyter_fs||[]).push([[838],{838:(e,t,s)=>{"use strict";s.r(t),s.d(t,{_activate:()=>P,default:()=>R});var n=s(590),o=s(137),i=s(26),r=s(653),a=s(129),c=s(271),l=s(456),d=s(34),h=s(110);new h.LabIcon({name:"jfs:drive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="24" height="24" viewBox="0 0 24 24" fill="none">\n  <path class="jp-icon3 jp-icon-selectable" stroke="#616161" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M22 12H2M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11zM6 16h.01M10 16h.01"/>\n</svg>\n'});const m=new h.LabIcon({name:"jfs:file-tree",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="20" viewBox="0 0 16 16">\n  <path class="jp-icon3" fill="#616161" d="M16 10V6H5v1H3V4h9V0H0v4h2v10h3v2h11v-4H5v1H3V8h2v2z"/>\n</svg>\n'}),u=(new h.LabIcon({name:"jfs:jupyter-fs",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="500" viewBox="0 0 100 100">\n  <rect class="jp-icon3" stroke="#616161" stroke-width="4" width="91" height="21" fill="none" rx="4" x="4.5" y="9.5"/>\n  <circle class="jp-icon3" fill="#616161" cx="85" cy="20" r="3"/>\n  <circle class="jp-icon3" fill="#616161" cx="73" cy="20" r="3"/>\n\n  <rect class="jp-icon3" stroke="#616161" stroke-width="4" width="91" height="21" fill="none" rx="4" x="4.5" y="39.5"/>\n  <circle class="jp-icon3" fill="#616161" cx="85" cy="50" r="3"/>\n  <circle class="jp-icon3" fill="#616161" cx="73" cy="50" r="3"/>\n\n  <rect class="jp-icon3" stroke="#616161" stroke-width="4" width="91" height="21" fill="none" rx="4" x="4.5" y="69.5"/>\n  <circle class="jp-icon3" fill="#616161" cx="85" cy="80" r="3"/>\n  <circle class="jp-icon3" fill="#616161" cx="73" cy="80" r="3"/>\n</svg>\n'}),new h.LabIcon({name:"jfs:visibility",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n  <path class="jp-icon3" fill="#616161" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>\n</svg>'})),p=new h.LabIcon({name:"jfs:visibility-off",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n  <path class="jp-icon3" fill="#616161" d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>\n</svg>'});class f extends class{constructor(e){this.template=e,this.pattern=/(?:)/}substitute(e){return this.template.replace(this.pattern,((t,s)=>e[s]))}tokens(){const e=[];let t;for(;t=this.pattern.exec(this.template);)e.push(t[1]);return e}}{constructor(){super(...arguments),this.pattern=/{{(\S+?)}}/g}}function g(e){return new f(e).tokens()}function v(e){return"ask"===e.auth&&!e.init}class b extends c.Component{constructor(e,t){super(e),this.state=b.initialState({open:!0,options:t})}render(){return c.createElement("div",null,c.createElement(d.Dialog,{className:"jfs-ask-dialog",open:this.state.open,onClose:this._onClose.bind(this)},c.createElement(d.DialogTitle,{className:"jfs-ask jfs-ask-dialog-title"},"Please enter token values for filesystem resources"),c.createElement(d.DialogContent,{className:"jfs-ask jfs-ask-dialog-content"},this._form()),c.createElement(d.DialogActions,{className:"jfs-ask jfs-ask-dialog-actions"},c.createElement(d.Button,{className:"jfs-ask jfs-ask-dialog-actions-button-cancel",onClick:this._onClose.bind(this),color:"primary"},"Cancel"),c.createElement(d.Button,{className:"jfs-ask jfs-ask-dialog-actions-button-submit",onClick:this._onSubmit.bind(this),color:"primary"},"Submit"))))}_form(){return c.createElement("form",{className:"jfs-ask jfs-ask-form",onSubmit:this._onSubmit.bind(this),noValidate:!0,autoComplete:"off"},this._formInner())}_formInner(){return this.props.resources.map((e=>{const t=v(e)?this._inputs(e.url):[],s=g(e.url);let n="";e.init&&this.props.options.cache?n="already initialized":s.length||(n="no template parameters");const o=`${e.name}:${n&&` ${n}`}`;return[c.createElement(d.ExpansionPanel,{className:"jfs-ask jfs-ask-panel",disabled:!!n,expanded:!n,key:`${e.name}_panel`},c.createElement(d.ExpansionPanelSummary,{className:"jfs-ask jfs-ask-panel-summary"},c.createElement(d.Typography,null,o),!n&&c.createElement(d.Typography,null,e.url)),c.createElement(d.ExpansionPanelDetails,{className:"jfs-ask jfs-ask-panel-details"},t))]}))}_inputs(e){return g(e).map((t=>{var s,n,o;return c.createElement(d.TextField,{className:"jfs-ask jfs-ask-input",autoFocus:!0,fullWidth:!0,key:`${e}_${t}`,label:t,margin:"dense",name:t,onChange:this._onChange(e).bind(this),type:(null===(s=this.state.visibility[e])||void 0===s?void 0:s[t])?"text":"password",value:(null===(n=this.state.values[e])||void 0===n?void 0:n[t])||"",InputProps:{endAdornment:c.createElement(d.InputAdornment,{position:"end"},c.createElement(d.IconButton,{onClick:this._onClickVisiblity(e,t).bind(this),onMouseDown:this._onMouseDownVisibility.bind(this),edge:"end"},(null===(o=this.state.visibility[e])||void 0===o?void 0:o[t])?c.createElement(u.react,null):c.createElement(p.react,null)))}})}))}_onChange(e){return function(t){const s=t.target;this._setValue(e,s.name,s.value)}}_onClickVisiblity(e,t){return function(){this._toggleVisibility(e,t)}}_onMouseDownVisibility(e){e.preventDefault()}_onOpen(){this.setState({open:!0})}_onClose(){this.setState(b.initialState({options:this.state.options})),this.props.handleClose()}async _onSubmit(e){e.preventDefault(),this.props.handleSubmit(this.state.values),this._onClose()}_setValue(e,t,s){const n={...this.state.values[e],[t]:s};this.setState({values:{...this.state.values,[e]:n}})}_toggleVisibility(e,t){var s;const n={...this.state.visibility[e],[t]:!(null===(s=this.state.visibility[e])||void 0===s?void 0:s[t])};this.setState({visibility:{...this.state.visibility,[e]:n}})}}b.displayName="AskDialog",function(e){e.initialState=({open:e=!1,options:t})=>({open:e,options:{...t},values:{},visibility:{}})}(b||(b={}));var y=s(514),w=s(515);class k extends class{constructor(e={}){this._settings=void 0;const{baseUrl:t}=e;t&&(this.baseUrl=t)}get baseUrl(){return this.settings.baseUrl}set baseUrl(e){e!==this.baseUrl&&(this._settings=w.ServerConnection.makeSettings({baseUrl:e}))}get resourcesUrl(){return y.URLExt.join(this.baseUrl,"jupyterfs/resources")}get settings(){return this._settings||(this._settings=w.ServerConnection.makeSettings()),this._settings}}{async getResourcesRequest(){const e=this.settings,t=this.resourcesUrl;return w.ServerConnection.makeRequest(t,{method:"GET"},e).then((e=>200!==e.status?e.text().then((t=>{throw new w.ServerConnection.ResponseError(e,t)})):e.json()))}async initResourceRequest(e){const t=this.settings,s=this.resourcesUrl;return w.ServerConnection.makeRequest(s,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"},method:"POST"},t).then((e=>200!==e.status?e.text().then((t=>{throw new w.ServerConnection.ResponseError(e,t)})):e.json()))}}var j=s(706),_=s(214);class x{constructor(e){this._model=new _.ClipboardModel,this._drive=new w.Drive,this._tracker=e,this._model.deleteSub.subscribe((async e=>{await Promise.all(e.map((e=>this._onDelete(e)))),this.model.refresh(this._tracker.currentWidget.treefinder.model,e)})),this._model.pasteSub.subscribe((async({destination:e,doCut:t,memo:s})=>{const n=_.Path.fromarray("dir"===e.kind?e.path:e.path.slice(0,-1));await Promise.all(s.map((e=>this._onPaste(e,n,t)))),this.model.refresh(this._tracker.currentWidget.treefinder.model,[e,...s])}))}refresh(e,t){null!=e||(e=this._tracker.currentWidget.treefinder.model),this.model.refresh(e,t)}refreshSelection(e){this.refresh(e,e.selection.map((e=>e.row)))}get model(){return this._model}async _onDelete(e){const t=_.Path.fromarray(e.path);await this._drive.delete(t)}async _onPaste(e,t,s){const n=_.Path.fromarray(e.path);await this._drive.copy(n,t),s&&await this._drive.delete(n)}}class C{constructor(e,t){this.cm=e,this.drive=t}async get(e){return e=C.toFullPath(e,this.drive),C.toJupyterContentRow(await this.cm.get(e),this.cm,this.drive)}}!function(e){function t(e,t){return!t||e.startsWith(`${t}:`)?e:[t,e].join(":")}e.toFullPath=t,e.toLocalPath=function(e){const[t,...s]=e.split("/");return[t.split(":").pop(),...s].join("/")},e.toJupyterContentRow=function e(s,n,o){const{path:i,type:r,...a}=s,c=t(i,o),l="directory"===r?"dir":r;return{path:_.Path.toarray(c),kind:l,...a,..."dir"===l?{getChildren:async()=>(await n.get(c,{content:!0})).content.map((t=>e(t,n,o)))}:{}}}}(C||(C={}));class S extends o.WidgetTracker{constructor(){super(...arguments),this._finders=new Map}async add(e){return this._finders.set(e.id,e),e.disposed.connect(this._onWidgetDisposed,this),super.add(e)}remove(e){this._finders.delete(e.id),e.disposed.disconnect(this._onWidgetDisposed,this)}findByDrive(e){return this._finders.get(e)}hasByDrive(e){return this._finders.has(e)}_onWidgetDisposed(e){this.remove(e)}}class I extends j.Widget{constructor({app:e,rootPath:t=""}){const{commands:s,serviceManager:{contents:n}}=e;super({node:document.createElement("tree-finder-panel")}),this.addClass("jp-tree-finder"),this.cm=new C(n,t),t=""===t?t:t+":",this.cm.get(t).then((e=>this.node.init({root:e,gridOptions:{columnFormatters:{last_modified:e=>_.Format.timeSince(e),size:e=>_.Format.bytesToHumanReadable(e)},doWindowResize:!0,showFilter:!0},modelOptions:{columnNames:["size","mimetype","last_modified"]}}))).then((()=>{this.model.openSub.subscribe((e=>e.forEach((e=>{e.getChildren||s.execute("docmanager:open",{path:_.Path.fromarray(e.path)})}))))}))}draw(){this.model.requestDraw()}refresh(){this.model.refreshSub.next()}get model(){return this.node.model}get selection(){return this.model.selection}get selectionPathstrs(){return this.model.selection.map((e=>_.Path.fromarray(e.row.path)))}}class D extends j.Widget{constructor({app:e,rootPath:t="",caption:s="TreeFinder",id:n="jupyterlab-tree-finder"}){super(),this.id=n,this.title.icon=m,this.title.caption=s,this.title.closable=!0,this.addClass("jp-tree-finder-sidebar"),this.commandIDs=Object.fromEntries(D.commandNames.map((e=>[e,`${this.id}:treefinder:${e}`]))),this.toolbar=new o.Toolbar,this.toolbar.addClass("jp-tree-finder-toolbar"),this.treefinder=new I({app:e,rootPath:t}),this.layout=new j.PanelLayout,this.layout.addWidget(this.toolbar),this.layout.addWidget(this.treefinder)}restore(){this.treefinder.refresh()}onBeforeShow(e){this.treefinder.refresh(),this.treefinder.draw()}onResize(e){this.treefinder.draw()}}!function(e){function t({app:t,manager:s,paths:n,resolver:i,restorer:r,router:c,rootPath:l="",caption:d="TreeFinder",id:m="jupyterlab-tree-finder",side:u="left"}){const p=`#${m}`,f=new e({app:t,rootPath:l,caption:d,id:m});e.tracker.add(f),r.add(f,f.id),t.shell.add(f,u);const g=new o.ToolbarButton({icon:h.refreshIcon,onClick:()=>{t.commands.execute(f.commandIDs.refresh)},tooltip:"Refresh"});return f.toolbar.addItem("refresh",g),[t.commands.addCommand(f.commandIDs.copy,{execute:t=>e.clipboard.model.copySelection(f.treefinder.model),icon:h.copyIcon,label:"Copy"}),t.commands.addCommand(f.commandIDs.cut,{execute:t=>e.clipboard.model.cutSelection(f.treefinder.model),icon:h.cutIcon,label:"Cut"}),t.commands.addCommand(f.commandIDs.delete,{execute:t=>e.clipboard.model.deleteSelection(f.treefinder.model),icon:h.closeIcon.bindprops({stylesheet:"menuItem"}),label:"Delete"}),t.commands.addCommand(f.commandIDs.open,{execute:e=>f.treefinder.model.openSub.next(f.treefinder.selection.map((e=>e.row))),label:"Open"}),t.commands.addCommand(f.commandIDs.paste,{execute:t=>e.clipboard.model.pasteSelection(f.treefinder.model),icon:h.pasteIcon,label:"Paste"}),t.commands.addCommand(f.commandIDs.refresh,{execute:t=>t.selection?e.clipboard.refreshSelection(f.treefinder.model):e.clipboard.refresh(f.treefinder.model),icon:h.refreshIcon,label:e=>e.selection?"Refresh Selection":"Refresh"}),t.contextMenu.addItem({command:f.commandIDs.open,selector:p,rank:1}),t.contextMenu.addItem({command:f.commandIDs.copy,selector:p,rank:2}),t.contextMenu.addItem({command:f.commandIDs.cut,selector:p,rank:3}),t.contextMenu.addItem({command:f.commandIDs.paste,selector:p,rank:4}),t.contextMenu.addItem({command:f.commandIDs.delete,selector:p,rank:5}),t.contextMenu.addItem({args:{selection:!0},command:f.commandIDs.refresh,selector:p,rank:10}),f].reduce(((e,t)=>(e.add(t),e)),new a.DisposableSet)}e.commandNames=["copy","cut","delete","open","paste","refresh","rename"],e.tracker=new S({namespace:"jupyter-fs:TreeFinder"}),e.clipboard=new x(e.tracker),e.sidebarFromResource=function(e,s){return t({...s,rootPath:e.drive,caption:`${e.name}\nFile Tree`,id:[e.name.split(" ").join(""),e.drive].join("_")})},e.sidebar=t}(D||(D={}));const E={activate:P,autoStart:!0,id:"jupyter-fs:plugin",requires:[i.IDocumentManager,n.JupyterFrontEnd.IPaths,o.IWindowResolver,n.ILayoutRestorer,n.IRouter,r.ISettingRegistry]};async function P(e,t,s,n,o,i,r){const d=new k;let h=new a.DisposableSet;const m={app:e,manager:t,paths:s,resolver:n,restorer:o,router:i};let u;try{u=await r.load(E.id)}catch(e){console.warn(`Failed to load settings for the jupyter-fs extension.\n${e}`)}async function p({resources:e,options:t}){t.verbose&&console.info(`jupyter-fs frontend received resources:\n${e}`);for(const t of e)h.add(D.sidebarFromResource(t,m))}async function f(){h.dispose(),h=new a.DisposableSet;let e=u.composite.resources;const t=u.composite.options;if(e=await d.initResourceRequest({resources:e,options:{...t,_addServerside:!0}}),function(e){for(const t of e)if(v(t))return!0;return!1}(e)){const s=document.createElement("div");document.body.appendChild(s);const n=()=>{l.unmountComponentAtNode(s),s.remove()},o=async s=>{await p({resources:await d.initResourceRequest({resources:e.map((e=>({...e,tokenDict:s[e.url]}))),options:t}),options:t})};l.render(c.createElement(b,{handleClose:n,handleSubmit:o,options:t,resources:e}),s)}else await p({options:t,resources:e})}u&&(f(),u.changed.connect(f))}const R=E}}]);
//# sourceMappingURL=838.0bce54ce935393d4dc38.js.map?v=0bce54ce935393d4dc38